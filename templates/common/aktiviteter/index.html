{% extends "common/aktiviteter/layout.html" %}
{% block title %}Turer og aktiviteter{% endblock %}
{% block breadcrumb %}<em><a href="{% url 'aktiviteter.views.index' %}">Turer og aktiviteter</a></em>{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ STATIC_URL }}lib/leaflet/leaflet.css" media="screen">
  <link rel="stylesheet" href="{{ STATIC_URL }}lib/leaflet.draw/leaflet.draw.css" media="screen">
  <!--[if lte IE 8]>
      <link rel="stylesheet" href="{{ STATIC_URL }}lib/leaflet/leaflet.ie.css" media="screen">
      <link rel="stylesheet" href="{{ STATIC_URL }}lib/leaflet.draw/leaflet.draw.ie.css" media="screen">
  <![endif]-->
{% endblock %}

{% block extra_js %}
  <script src="{{ STATIC_URL }}lib/leaflet/leaflet.js"></script>
  <script src="{{ STATIC_URL }}lib/leaflet.draw/leaflet.draw.js"></script>
  <script src="{{ STATIC_URL }}js/public/aktiviteter/index.js"></script>
{% endblock %}

{% block js_globals %}
  <script>
    Turistforeningen.aktivitet_points = JSON.parse("{{ aktivitet_positions_json|escapejs }}");
  </script>
{% endblock %}

{% block body %}

{{ block.super }}

<div class="aktivitet-listing">

  <div class="row">
    <div class="col-md-4">
      <div class="column-query-parameters">
        <h2>Finn en tur</h2>

        <div class="search-filters">
          <div class="section">
            <h3>Jeg vil se</h3>
            <div class="button-selections categories">
              {% for category in categories %}
                <button class="btn category" data-category="{{ category.0 }}">{{ category.1 }}</button>
              {% endfor %}
            </div>
          </div>
        </div>

        <div class="search-filters">

          <div class="section">
            <div class="input-group">
              <input class="form-control search-query" type="text" name="search">
              <span class="input-group-btn">
                <button type="button" class="btn btn-default">Søk</button>
              </span>
            </div>
          </div>

          <div class="section">
            <h3>Fra-til dato</h3>
            <div class="input-group date" data-dnt-container="start-date">
              <input class="form-control date" type="text" name="start_date" placeholder="">
              <span class="input-group-addon">
                <i class="glyphicon glyphicon-calendar"></i>
              </span>
            </div>
            <br>

            <div class="input-group date" data-dnt-container="end-date">
              <input class="form-control date" type="text" name="end_date" placeholder="">
              <span class="input-group-addon">
                <i class="glyphicon glyphicon-calendar"></i>
              </span>
            </div>
          </div>

          <div class="section">
            <h3>I nærheten av sted</h3>
            <input class="form-control" name="ssr_id" type="hidden" data-select-show="position-map position-metadata">
          </div>

          <div class="section">
            <h3>Turområde</h3>
            <select class="form-control" name="location" data-placeholder="Velg turområder..." multiple>
              <option value=""></option>
              {% for location in locations %}
                <option value="{{ location.id }}">{{ location.name }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="section">
            <h3>Passer for</h3>
            <div class="button-selections audiences">
              {% for audience in audiences %}
                <button class="btn audience" data-audience="{{ audience.0 }}">{{ audience.1 }}</button>
              {% endfor %}
            </div>
          </div>

          <div class="section">
            <h3>Gradering</h3>
            <div class="button-selections difficulties">
              {% for difficulty in difficulties %}
                <button class="btn difficulty" data-difficulty="{{ difficulty.0 }}">{{ difficulty.1 }}</button>
              {% endfor %}
            </div>
          </div>

          <div class="section">
            <h3>Arrangør</h3>
            <select class="form-control" name="organizers" data-placeholder="Velg arrangør..." multiple>
              <option value=""></option>

              {% for type in all_foreninger %}
                {% if type.foreninger|length > 0 %}
                  <optgroup label="{{ type.name }}">
                    {% for forening in type.foreninger %}
                      <option value="forening:{{ forening.id }}">{{ forening.name }}</option>
                    {% endfor %}
                  </optgroup>
                {% endif %}
              {% endfor %}

              <optgroup label="Hytter">
                {% for cabin in cabins %}
                  {% if aktivitet.forening_cabin == cabin %}
                    <option value="cabin:{{ cabin.id }}" selected>{{ cabin.name }}</option>
                  {% else %}
                    <option value="cabin:{{ cabin.id }}">{{ cabin.name }}</option>
                  {% endif %}
                {% endfor %}
              </optgroup>

            </select>
          </div>

        </div><!-- /.search-filters -->

      </div>

    </div>

    <div class="col-md-8">
      <div class="column-results">

        <div class="showing">
          <p>Viser <span data-container-for="selected-activity-types"><a href="#">turer med guide</a>, <a href="#">kurs</a>, <a href="#">fellesturer</a> og <a href="#">dugnader</a></span></p>
        </div>

        <div class="results" data-filter-url="{% url 'aktiviteter.views.filter' %}">

          <div class="content" data-current-page="{{ aktivitet_dates.number }}">
            {% include 'common/aktiviteter/listing.html' %}
          </div>

          <div class="loading jq-hide">
            <img src="{{ STATIC_URL }}img/common/ajax-loader-small.gif" alt="Laster, vennligst vent...">
            Laster, vennligst vent...
          </div>

          <div class="fail jq-hide alert alert-error">
            <strong>Beklager, det oppstod en teknisk feil!</strong><br>
            Feilen har blitt logget i vårt system, og vi vil rette den så snart som mulig. I mellomtiden kan du forsøke å <a href="javascript:document.location.reload(true);">oppdatere siden</a>.
          </div>

        </div>
      </div>
    </div>
  </div>

  <div id="map" class="leaflet-map"></div>
  <div class="popups jq-hide">
    {% for aktivitet in aktivitet_positions %}
      <div class="popup-content" data-aktivitet-date-id="{{ aktivitet.id }}">
        <h3>{{ aktivitet.title }}</h3>
        <p>
          {% if aktivitet.is_imported %}
            {{ aktivitet.description|striptags|truncatewords:"30" }}
          {% else %}
            {{ aktivitet.description|truncatewords:"30" }}
          {% endif %}
        </p>
      </div>
    {% endfor %}
  </div>
</div>

{% endblock %}
