{% extends 'common/admin/layout.html' %}
{% block title %}Aktiviteter &mdash; {{ block.super }}{% endblock %}
{% block header %}<a href="{% url 'admin.aktiviteter.views.index' %}">Aktiviteter</a>{% endblock %}

{% block js_globals %}
  <script>
    window.Turistforeningen = {
      admin_user_search_char_length: {{ admin_user_search_char_length }}
    };
  </script>
{% endblock %}

{% block extra_js %}
  <script src="{{ STATIC_URL }}js/admin/tags.js"></script>
  <script src="{{ STATIC_URL }}js/admin/aktiviteter/edit/leaders.js"></script>
{% endblock %}

{% block body %}

<div class="row">
  <div class="span12">

    <div class="edit-aktivitet-leaders" data-aktivitet-id="{{ aktivitet.id }}">

      <h2>Rediger aktivitet</h2>

      {% include 'common/admin/aktiviteter/edit/navigation.html' with active='leaders' %}

      <p>
        Her kan du gi turledere tilgang til påmeldtlisten. Det trenger ikke nødvendigvis være en turleder, du kan hente ut hvem som helst fra medlemsregisteret, men han/henne <strong>må ha en bruker på Min side</strong>.
      </p>

      {% if aktivitet.dates.count == 0 %}

        <p>
          Du må velge hvilke turdatoer turlederen har tilgang til, men denne aktiviteten har ingen oppsatte datoer.<br>
          <a href="{% url 'admin.aktiviteter.views.edit_dates' aktivitet.id %}">Velg turdatoer her først</a>, så kan du komme tilbake hit og legge til turledere.
        </p>

      {% else %}

        <p>
          Hvis aktiviteten har flere datoer, velger du hvilke datoer turlederen har tilgang til. Husk derfor å gjøre deg ferdig med <a href="{% url 'admin.aktiviteter.views.edit_dates' aktivitet.id %}">datoer og påmelding</a> først.
        </p>

        <div class="leader-management form-border">

          {% for date in aktivitet.get_dates_ordered %}
            <div class="date" data-date-id="{{ date.id }}">
              <h3>Turledere {{ date.start_date|date:"j. F Y" }} - {{ date.end_date|date:"j. F Y" }}</h3>
              <table class="leaders">
                {% for user in date.leaders.all %}
                  <tr data-user-id="{{ user.id }}">
                    <td>
                      <form action="{% url 'admin.aktiviteter.views.leader_remove' %}" method="post" class="remove-leader">
                        {% csrf_token %}
                        <input type="hidden" name="aktivitet_date" value="{{ date.id }}">
                        <input type="hidden" name="user" value="{{ user.id }}">
                        <a href="javascript:undefined" class="remove"><i class="icon-remove"></i></a>
                        {{ user.get_full_name }}
                      </form>
                    </td>
                  </tr>
                {% empty %}
                  <tr>
                    <td>Ingen turledere er satt opp for denne turen.</td>
                  </tr>
                {% endfor %}
              </table>
            </div>
          {% endfor %}

          <div class="leader-search">
            <h3>Finn nye turledere:</h3>
            <input type="text" class="input-xlarge" name="leader-search" placeholder="Navn eller medlemsnummer...">
            <button class="btn leader-search input-button-align"><i class="icon-search"></i></button>

            <table class="table search-results hide" data-search-url="{% url 'admin.aktiviteter.views.leader_search' %}">
              <tr>
                <th>Navn</th>
                <th>Medlemsnummer</th>
                <th>Gi turlederstatus</th>
              </tr>

              <tr class="no-hits hide">
                <td colspan="3">Fant ingen med navn eller medlemsnummer <span class="result-mirror"></span>.</td>
              </tr>

              <tr class="short_query hide">
                <td colspan="3">
                  Du må bruke minst {{ admin_user_search_char_length }} tegn når du søker, ellers vil du få alt for mange treff.
                </td>
              </tr>

              <tr class="technical-error hide">
                <td colspan="3">
                  <div class="alert alert-error">
                    Beklager, det oppstod en teknisk feil ved oppslag i databasen. Feilen har blitt logget og vi vil se på problemet så snart som mulig.
                  </div>
                </td>
              </tr>

              <tr class="max-hits-exceeded hide">
                <td colspan="3">
                  Du fikk veldig mange treff, kun et utvalg vises her.<br>
                  Prøv å søke på noe litt mer spesifikt, som for eksempel medlemsnummeret.
                </td>
              </tr>

              <tr class="loader hide">
                <td colspan="3">
                  Vennligst vent mens vi søker.<br>
                  Medlemsdatabasen er stor, så dette kan ta noen sekunder.<br>
                  <img src="{{ STATIC_URL }}img/ajax-loader-large.gif" alt="Laster, vennligst vent...">
                </td>
              </tr>
            </table>
          </div>

        </div>

      {% endif %}

    </div>
  </div>
</div>

{% endblock %}
