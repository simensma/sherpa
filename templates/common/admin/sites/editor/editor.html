{% load render_widget %}

<div class="row">
  <div class="offset3 span6">
    <div class="no-save-warning alert alert-danger jq-hide">
      <a class="close">x</a>
      <strong>Advarsel!</strong><br>
      Du har ikke lagret artikkelen på over 5 minutter! Du bør vurdere å lagre nå, hvis ikke kan du miste endringene du har gjort hvis et uhell oppstår.
    </div>
  </div>
</div>

<article
  data-save-url="{% url 'admin.sites.pages.content.save' active_site.id version.id %}"
  data-render-widget-url="{% url 'admin.sites.pages.content.reload_raw_widget' active_site.id %}"
  data-columns-into-columns-warning="Du kan ikke sette inn kolonner her, fordi det er allerede %s kolonner fra før av.\n\nBruk pluss-knappen over eller under som dekker hele kolonne-bredden.">

  {% comment %}
    Note that data-id is set on row, column and content elements, but they are never used. This is for ease
    of debugging, in case there is a need to inspect the DOM, find the element ID and look it up in the db.
  {% endcomment %}

  {% for row in version.get_rows %}
    {# Rows are recognized by their data-row attribute, not their class #}
    <div class="row-fluid" data-row data-id="{{ row.id }}">

      {% for column in row.get_columns %}
        <div class="column offset{{ column.offset }} span{{ column.span }}" data-id="{{ column.id }}">

          {% for content in column.get_contents %}
            {% if content.type == 'html' or content.type == 'title' or content.type == 'lede' %}

              <div class="content {{ content.type }} editable" {% if content.content != '' %}contenteditable="true"{% else %}data-placeholder{% endif %} data-id="{{ content.id }}">
                {% if content.content != '' %}
                  {{ content.content|safe }}
                {% else %}
                  Klikk for å legge til tekst
                {% endif %}
              </div>

            {% elif content.type == 'image' %}

              {% comment %}
                Note that we're using the original image size here in the admin interface intentionally.
                In case the user changes the column size we want the image to keep its quality.
              {% endcomment %}

              <div class="content image" data-json="{{ content.content }}" data-id="{{ content.id }}">
                {% if content.get_content.anchor %}
                  <a href="{{ content.get_content.anchor }}">
                    <img src="{{ content.get_content.src }}" alt="{{ content.get_content.description }}">
                  </a>
                {% else %}
                  <img src="{{ content.get_content.src }}" alt="{{ content.get_content.description }}">
                {% endif %}

                {% if content.get_content.description or content.get_content.photographer %}
                  <div class="description">
                    {% if content.get_content.description %}
                      <span class="description">{{ content.get_content.description }}</span>
                    {% endif %}
                    {% if content.get_content.photographer %}
                      <span class="photographer">
                        Foto: <span class="content">{{ content.get_content.photographer }}</span>
                      </span>
                    {% endif %}
                  </div>
                {% endif %}
              </div>

            {% elif content.type == 'widget' %}

              {% render_widget content admin_context=True %}

            {% endif %}
          {% endfor %}

        </div>
      {% endfor %}

    </div>
  {% endfor %}

</article>

{# Hidden templates to be cloned and inserted with javascript #}
<div class="insertion-templates jq-hide">

  {# The default row with a full-sized column #}
  <div class="row-fluid" data-row>
    <div class="column span12"></div>
  </div>

  {# The default HTML content element #}
  <div class="content html editable" contenteditable="true"></div>

  {# The default image content element #}
  <div class="content image" data-json="{&quot;src&quot;:&quot;http://www.turistforeningen.no/static/img/placeholder.png&quot;,&quot;description&quot;:&quot;&quot;,&quot;photographer&quot;:&quot;&quot;,&quot;anchor&quot;:null}">
    <a href="">
      <img src="http://www.turistforeningen.no/static/img/placeholder.png" alt="">
    </a>
    <div class="description">
      <span class="description"></span>
      <span class="photographer">
        Foto: <span class="content"></span>
      </span>
    </div>
  </div>

  {# The default widget content element #}
  <div class="content widget">
    <img src="/static/img/ajax-loader-small.gif" alt="Laster...">
    <em>Vennligst vent...</em>
  </div>

  {# Error message to be displayed if widget rendering fails #}
  <div class="alert alert-error widget-rendering-failed">
    <strong>Teknisk feil</strong><br>
    Kunne ikke vise innholdet. Er du sikker på at du har tilgang til internett?<br>
    Klikk her og velg lagre på nytt for å prøve en gang til.
  </div>

  {# Editor-control: The column-structure controls to be shown above each separate row #}
  <div class="row-fluid edit-structure">
    <div class="column span12">
      <div class="edit-structure-inner">
        <button class="btn" data-type="single" title="Bruk én stor kolonne i denne seksjonen"></button>
        <button class="btn" data-type="double" title="Bruk to like store kolonner i denne seksjonen"></button>
        <button class="btn" data-type="sidebar-left" title="Bruk to kolonner i denne seksjonen, liten kolonne til venstre"></button>
        <button class="btn" data-type="sidebar-right" title="Bruk to kolonner i denne seksjonen, liten kolonne til høyre"></button>
        <button class="btn" data-type="triple" title="Bruk tre kolonner i denne seksjonen"></button>
        <button class="btn" data-type="quadruple" title="Bruk fire kolonner i denne seksjonen"></button>
      </div>
    </div>
  </div>

  {# Editor-control: Plus-sign to allow user to add content #}
  <div class="add-content" title="Sett inn innhold...">
  </div>

  {# Editor-control: Replaces the add-content control when moving content #}
  <div class="drop-area">
    Klikk for å flytte hit...
  </div>

  {# Editor-control: Popover content #}
  <div data-dnt-container="add-content-popover-content">
    <button class="btn" data-type="text" title="Sett inn en tittel, ingress, eller vanlig tekst">Tekst</button>
    <button class="btn" data-type="widget" data-widget="button" title="Sett inn en stor knapp">Knapp</button>
    <button class="btn" data-type="image" title="Sett inn et bilde. Du kan laste opp selv eller finne et i bildearkivet.">Bilde</button>
    <button class="btn" data-type="widget" data-widget="carousel" title="Lar deg velge flere bilder som vises i en karusell, som roterer automatisk.">Bildekarusell</button>
    <button class="btn" data-type="widget" data-widget="embed" title="Video fra YouTube, Vimeo eller liknende. Kan også brukes til å sette inn ren HTML på siden.">Video/embed</button>
    <button class="btn" data-type="widget" data-widget="quote" title="Et sitat med tilpasset design (litt større tekst, strek foran navnet, etc).">Sitat</button>
    <button class="btn" data-type="widget" data-widget="fact" title="Som vanlig tekst, men med grå bakgrunn - passer best i sidekolonner.">Faktaboks</button>
    <button class="btn" data-type="widget" data-widget="articles" title="Liste over siste nyheter, plasseres vanligvis kun på forsiden.">Nyheter</button>
    <button class="btn" data-type="widget" data-widget="blog" title="Liste over siste innlegg på Turistforeningens blogg.">Blogg</button>
    <button class="btn" data-type="widget" data-widget="table" title="Tabell med redigerbart antall rader og kolonner.">Tabell</button>
    <button class="btn" data-type="widget" data-widget="campaign" title="Legg til en kampanje. Disse må lages på forhånd, og så kan du legge dem inn her.">Kampanje</button>
    <button class="btn" data-type="columns" title="Del opp denne raden, slik at du videre kan dele opp i kolonner. Når den er delt kan du for eksempel la innholdet i raden over være i én kolonne, men la innholdet i raden under deles opp i to kolonner.">Kolonner</button>
  </div>


  {# Editor-control: Button to display on image-content hover to crop images #}
  <div class="content-control crop-content" title="Beskjær bildet">
  </div>

  {# Editor-control: Button to display on content hover to remove content #}
  <div class="content-control remove-content" title="Ta bort dette innholdet" data-confirm="Er du helt sikker på at du vil ta bort dette innholdet?">
  </div>

  {# Editor-control: Button to display on content hover to move content #}
  <div class="content-control move-content" title="Klikk for å flytte innholdet opp, ned eller til en annen kolonne">
  </div>

  {# Editor-control: Cropping controls to display during cropping #}
  <div class="crop-control">
    <div class="submit pull-right">
      <button class="btn btn-success use">
        <i class="icon-white icon-check"></i> Bruk dette utsnittet
      </button>
      <button class="btn remove">
        <i class="icon-remove"></i> Vis hele bildet
      </button>
    </div>

    <div class="choose-ratio">
      <p>
        <strong>Velg utsnitt:</strong>
      </p>
      <div class="btn-group" data-toggle="buttons-radio">
        <button class="btn" data-ratio="free">Fri</button>
        <button class="btn" data-ratio="16:9">Widescreen</button>
        <button class="btn" data-ratio="12:8">Landskap</button>
        <button class="btn" data-ratio="3:4">Portrett</button>
        <button class="btn" data-ratio="1:1">Firkant</button>
      </div>
    </div>
  </div>
</div>

{# Widget edit-dialogs #}
{% include 'common/widgets/quote/edit.html' %}
{% include 'common/widgets/articles/edit.html' %}
{% include 'common/widgets/blog/edit.html' %}
{% include 'common/widgets/embed/edit.html' %}
{% include 'common/widgets/carousel/edit.html' %}
{% include 'common/widgets/fact/edit.html' %}
{% include 'common/widgets/button/edit.html' %}
{% include 'common/widgets/table/edit.html' %}
{% include 'common/widgets/campaign/edit.html' %}

{# Other dialogs #}
{% include 'common/admin/images/util/image-archive-picker.html' with bs2compatible=True %}
{% include 'common/admin/images/util/image-upload-dialog-bootstrap2compatible.html' %}
{% include 'common/admin/sites/editor/image-dialog.html' %}
{% include 'common/admin/sites/editor/toolbar.html' %}
