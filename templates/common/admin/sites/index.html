{% extends 'common/admin/layout.html' %}

{% load role_for %}

{% block title %}Hjemmesider â€” {{ block.super }}{% endblock %}

{% block admin_menu %}{% with 'sites' as active_entry %}{{ block.super }}{% endwith %}{% endblock %}

{% block extra_js %}
  <script src="{{ STATIC_URL }}js/admin/sites/index.js"></script>
{% endblock %}

{% block body %}

<div class="row">
  <div class="col-lg-12">
    <h1>Nettsteder <small>tilknyttet {{ active_forening.name }}</small></h1>
    <ol class="breadcrumb">
      <li class="active"><i class="fa fa-dashboard"></i> <a href="{% url 'admin.views.index' %}">Sherpa</a></li>
      <li><a href="{% url 'admin.sites.views.index' %}">Nettsteder</a></li>
    </ol>
  </div>
</div><!-- /.row -->

{% with sites=active_forening.get_sites_sorted %}

  <table class="table">
    <tr>
      <th>Type</th>
      <th>Nettsted</th>
      <th>Tittel</th>
    </tr>
    {% for site in active_forening.get_sites_sorted.forening %}
      <tr{% if site == active_site %} class="active"{% endif %}>
        <td>Hjemmeside</td>
        <td><a href="{% url 'admin.sites.views.show' site.id %}">{{ site.domain }}</a></td>
        <td>{{ site.get_title }}</td>
      </tr>
    {% endfor %}
    {% for site in active_forening.get_sites_sorted.hytte %}
      <tr{% if site == active_site %} class="active"{% endif %}>
        <td>Hytteside</td>
        <td><a href="{% url 'admin.sites.views.show' site.id %}">{{ site.domain }}</a></td>
        <td>{{ site.get_title }}</td>
      </tr>
    {% endfor %}
    {% for site in active_forening.get_sites_sorted.kampanje %}
      <tr{% if site == active_site %} class="active"{% endif %}>
        <td>Kampanjeside</td>
        <td><a href="{% url 'admin.sites.views.show' site.id %}">{{ site.domain }}</a></td>
        <td>{{ site.get_title }}</td>
      </tr>
    {% endfor %}

    {% if active_forening.sites.count == 0 %}
      {# This can happen if the active forening has no sites but we're editing the site for another forening #}
      <tr>
        <td colspan="3">
          <em>{{ active_forening.name }} har ingen nettsteder.
          {% if user|role_for:active_forening == 'admin' %}
            <a href="{% url 'admin.views.setup_site' %}">Opprett en hjemmeside for {{ active_forening.name }}</a></em>
          {% endif %}
        </td>
      </tr>
    {% endif %}
  </table>

{% endwith %}

{% if user|role_for:active_forening == 'admin' %}
  <p>
    <a href="{% url 'admin.views.setup_site' %}" class="btn btn-default">Opprett et nytt nettsted tilknyttet {{ active_forening.name }}</a>
  </p>
{% endif %}

{% if children_foreninger_with_site|length > 0 %}

  <h2>Nettsteder for turlag og turgrupper</h2>

  <table class="table">
    <tr>
      <th>Forening</th>
      <th>Type</th>
      <th>Nettsted</th>
      <th>Tittel</th>
    </tr>

    {% for forening in children_foreninger_with_site %}
      {% for site in forening.sites.all %}

        <tr{% if site == active_site %} class="active"{% endif %}>
          <td>
            {% if forloop.first %}
              {{ forening.name }}
            {% endif %}
          </td>
          <td>{{ site.get_type_short }}</td>
          <td><a href="{% url 'admin.sites.views.show' site.id %}">{{ site.domain }}</a></td>
          <td>{{ site.get_title }}</td>
        </tr>

      {% endfor %}
    {% endfor %}

  </table>

{% endif %}

{% endblock %}
