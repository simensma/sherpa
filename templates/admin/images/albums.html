{% extends "admin/images/layout.html" %}
{% block extra_scripts %}
  <script src="{{ STATIC_URL }}js/admin/images/browser.js"></script>
  <script src="{{ STATIC_URL }}js/admin/images/info.js"></script>
{% endblock %}

{% block imagebody %}
{% if not albums and not images %}
<div class="alert alert-info">Dette albumet er tomt.</div>
{% endif %}

{# The 8px accounts for opera which seems to add that margin to disabled buttons. Without, there's a bug in the background-display of the album/image boxes. #}
<div class="row" style="margin-bottom: 8px;">
  <div class="offset3 span6">
    <table class="action-buttons">
    <tr>
      <td>
        <form style="margin: 0;" action="{% if current_album %}{% url admin.images.views.upload_image current_album.id %}{% endif %}" method="get">
        <button class="btn btn-success"{% if not current_album %} disabled{% endif %}><i class="icon-picture"></i> Last opp nytt bilde her</button>
        </form>
      </td>
      <td><button class="btn btn-success dialog-button" data-dialog=".album-dialog"><i class="icon-folder-open"></i> Opprett nytt album her</button></td>
    </tr>
    <tr>
      <td><button class="btn btn-warning context-button details-button"><i class="icon-pencil"></i> Endre detaljer</button></td>
      <td><button class="btn btn-danger context-button delete-button dialog-button" data-dialog=".delete-dialog"><i class="icon-remove"></i> Slett bilder</button></td>
    </tr>
    </table>
  </div>
</div>

<div id="archive-gallery">
  <ul>
  {% for album in albums %}
    <li class="album" data-id="{{ album.id }}">
      <button class="btn mark"><i class="icon-tags"></i> Merk album</button>
      <a class="image" href="{% url admin.images.views.list_albums album.id %}">
        <img src="{{ STATIC_URL }}img/icons/imagearchive/folder.png" alt="Album: {{ album.name }}">
      </a>
      <a class="text" href="{% url admin.images.views.list_albums album.id %}">{{ album.name }}</a>
    </li>
  {% endfor %}
  {% for image in images %}
    <li class="image" data-id="{{ image.id }}">
      <button class="btn mark"><i class="icon-tag"></i> Merk bilde</button>
      <a class="image" href="{% url admin.images.views.image_details image.id %}">
        <img src="http://cdn.turistforeningen.no/images/{{ image.key }}-150.{{ image.extension }}" alt="{{ image.description }}">
      </a>
      {{ image.width }} x {{ image.height }}<br>
      {% if not image.photographer %}
        Ingen fotograf oppgitt
      {% else %}
        Fotograf: {{ image.photographer }}
      {% endif %}
    </li>
  {% endfor %}
  </ul>
</div>
<div style="clear: both;"></div>

<div class="dialog delete-dialog" data-title="Slett album/bilder" data-width="500">
  <p></p>
  <form action="{% if current_album %}{% url admin.images.views.delete_items current_album.id %}{% else %}{% url admin.images.views.delete_items %}{% endif %}" method="post">
    {% csrf_token %}
    <input type="hidden" name="albums">
    <input type="hidden" name="images">
    <button class="btn btn-danger perform-delete"><i class="icon-warning-sign"></i> Ja, jeg vil virkelig slette slette dem for godt.</button>
  </form>
  <button class="btn btn-success cancel-delete"><i class="icon-heart"></i> Nei, jeg vil ikke slette noe likevel.</button>
</div>

<div class="dialog album-dialog" data-title="Legg til album" data-width="auto">
  <form action="{% if album %}{% url admin.images.views.add_album album %}{% else %}{% url admin.images.views.add_album %}{% endif %}" method="post">
    {% csrf_token %}
    <p>Navn på nytt album: <input type="text" name="name"></p>
    <p><input type="submit" value="Legg til album"></p>
  </form>
</div>


<div class="dialog image-details" data-title="Oppdater bildeinformasjon" data-width="400px">
  <form action="{% url admin.images.views.update_images %}" method="post">
    {% csrf_token %}
    <label>Beskrivelse av bildene:</label>
    <textarea name="description" class="span4" rows="3"></textarea>
    <label>Fotograf:</label>
    <input type="text" class="span4" name="photographer" placeholder="Fullt navn..."><br>
    <label>Kreditering:</label>
    <input type="text" class="span4" name="credits" placeholder="Navn på person, forening e.l..."><br>
    <label>Bruksrett:</label>
    <input type="text" class="span4" name="licence" placeholder="Kun ved behov..."><br>
    <label>Nøkkelord</label>
    <input type="text" class="span4" name="tags">
    <input type="hidden" name="tags-serialized">
    <div id="tags"></div>
    <div style="clear: both;"></div>
    <input type="submit" class="btn" value="Lagre bildedata">
    <input type="hidden" name="ids">
    <p><strong>Merk:</strong> Vi sletter ikke gamle felt. Så hvis du for eksempel kun endrer beskrivelse (og ikke fotograf), så bevarer vi den gamle fotografen som allerede er oppgitt.</p>
  </form>
</div>

<div class="dialog album-details" data-title="Oppdater albuminformasjon" data-width="auto">
  <form action="{% url admin.images.views.update_album %}" method="post">
    {% csrf_token %}
    <p>Nytt navn: <input type="text" name="name"></p>
    <input type="hidden" name="albums">
    <p><input type="submit" value="Oppdater album"></p>
  </form>
</div>
{% endblock %}
