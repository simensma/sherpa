{% extends 'main/layout.html' %}

{% block title %}Fjelltreffen{% endblock %}
{% block breadcrumb %}
  {% if annonse %}
    <a href="{% url fjelltreffen.views.index %}">Fjelltreffen</a> /  <a href="{% url fjelltreffen.views.mine %}">Mine Annonser</a> / <em><a href="{% url fjelltreffen.views.edit annonse.id %}">{{ annonse.title }}</a></em>
  {% else %}
    <a href="{% url fjelltreffen.views.index %}">Fjelltreffen</a> / <em><a href="{% url fjelltreffen.views.new %}">Ny Annonse</a></em>
  {% endif %}
{% endblock %}

{% block extra_js %}
  <script src="{{ STATIC_URL }}js/fjelltreffen/fjelltreffen-edit.js"></script>
{% endblock%}

{% block body %}

<div class="row">
  <div class="span9">

    {% if annonse %}
      <h2>Rediger Annonse</h2>
    {% else %}
      <h2>Ny Annonse</h2>
    {% endif %}

    {% if annonse.is_expired %}
      <div class="alert alert-error">
        Denne annonsen har lagt ute i mer enn {{ annonse_retention_days }} dager og er derfor utgått.
      </div>
    {% endif %}

    {% for message in messages %}
      {% if message.message == 'missing_title' %}
        <div class="alert alert-error">
          <a class="close">x</a>
          Du må fylle inn en tittel på annonsen!
        </div>
      {% elif message.message == 'invalid_email' %}
        <div class="alert alert-error">
          <a class="close">x</a>
          Du må fylle inn en gyldig e-postadresse! Du vil motta svar på annonsen på denne adressen. Adressen vises ikke i annonsen.
        </div>
      {% elif message.message == 'missing_text' %}
        <div class="alert alert-error">
          <a class="close">x</a>
          Du får neppe napp med mindre du skriver litt om hvem du er, eller hva du er ute etter, i annonsen.
        </div>
      {% elif message.message == 'too_many_active_annonser' %}
        <div class="alert alert-error">
          <a class="close">x</a>
          Du har for mange aktive annonser! Du kan på det meste ha {{ active_annonse_limit }} synlige annonser av gangen. Annonsen har blitt satt som skjult. Du kan slette eller skjule <a href="{% url fjelltreffen.views.mine %}">dine andre annonser</a>, for så å vise denne.
        </div>
      {% elif message.message == 'showing_when_not_payed' %}
        <div class="alert alert-error">
          <a class="close">x</a>
          Du kan ikke vise en skjult annonse når du ikke har betalt årskontingenten.
        </div>
      {% endif %}
    {% endfor %}

    <form action="{% url fjelltreffen.views.save %}" method="post" class="fjelltreffen-annonse-edit">
      {% csrf_token %}
      <input type="hidden" name="id" value="{{ annonse.id }}">

      <div class="control-group title">
        <input type="text" name="title" value="{{ annonse.title }}" placeholder="Tittel" class="input-large">
        <span class="asterisk red">*</span>
      </div>

      <div class="control-group email">
        <input type="text" name="email" value="{% firstof annonse.email user.get_profile.get_email %}" placeholder="Din e-postadresse (vises ikke)">
        <span class="asterisk red">*</span>
      </div>


      <select name="county">
        {% for county in counties %}
          {% if annonse %}
            <option{% if annonse.county.code == county.code %} selected="selected"{% endif %} value="{{ county.code }}">{{ county.name }}</option>
          {% else %}
            <option{% if user.get_profile.get_county == county.code %} selected="selected"{% endif %} value="{{ county.code }}">{{ county.name }}</option>
          {% endif %}
        {% endfor %}
      </select>

      <div class="control-group text">
        <textarea name="text" placeholder="Skriv annonsen din her...">{{ annonse.text }}</textarea><br>
      </div>

      <input type="checkbox" name="hideage"{% if annonse.hideage %} checked="checked"{% endif %}>Skjul min virkelige alder(vil vises som 40-44 hvis du er 43)<br>
      <p class="hide-annonse"{% if annonse.hidden and not user.get_profile.get_actor.get_balance.is_payed %} title="Du kan ikke vise en skjult annonse når du ikke har betalt årskontingenten."{% endif %}>
        <input type="checkbox" name="hidden"{% if annonse.hidden %} checked="checked"{% endif %}{% if annonse.hidden and not user.get_profile.get_actor.get_balance.is_payed %} disabled{% endif %}>Skjul annonsen(kan kun sees av deg fra "mine annonser")
      </p>
      <p>Merk: Annonsen blir liggende i {{ annonse_retention_days }} dager.</p>
      <button type="submit" class="btn btn-success save-annonse">Lagre</button>
      {% if annonse %}
        <a class="btn btn-danger" href="{% url fjelltreffen.views.delete annonse.id %}">Slett</a>
      {% endif %}
    </form>

  </div>
  <div class="span3">
    {% if annonse %}
      {% include 'main/fjelltreffen/navigation.html' %}
    {% else %}
      {% include 'main/fjelltreffen/navigation.html' with active='new' %}
    {% endif %}
  </div>
</div>

{% endblock %}
