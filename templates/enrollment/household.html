{% extends 'enrollment/index.html' %}
{% block extra_css %}
  <link rel="stylesheet" href="{{ STATIC_URL }}css/enrollment.css" media="screen">
{% endblock %}
{% block extra_js %}
  <script src="{{ STATIC_URL }}js/enrollment/household.js"></script>
{% endblock %}

{% block enrollment %}

<script>
  var existing = {% if existing %}true{% else %}false{% endif %};
  var invalid_existing = {% if invalid_existing %}true{% else %}false{% endif %};
</script>

{% if errors %}
<script>
  // Trigger form validations
  $(document).ready(function() {
    $("form#household input").focusout();
  });
</script>
{% endif %}

{% if invalid_existing %}
<div class="row">
  <div class="offset2 span8">
    <div class="alert alert-error">
      <a class="close">x</a><strong>Ugyldig medlemsnummer</strong><br>
      Vennligst sjekk at all oppgitt medlemsnummer for eksisterende medlem på samme adresse er korrekt.
    </div>
  </div>
</div>
{% endif %}

{% if errors %}
<div class="row">
  <div class="offset2 span8">
    <div class="alert alert-error">
      <a class="close">x</a><strong>Noen av opplysningene du oppgav er ugyldige.</strong><br>
      Vennligst se gjennom skjemaet, og rett alle felter som er markert røde.
    </div>
  </div>
</div>
{% endif %}

<div class="row">
  <div class="span8">

    {% include 'enrollment/progress.html' with step=2 %}

    <form id="household" action="{% url enrollment.views.household %}" method="post">
      {% csrf_token %}

      <div class="border">
        <h2 style="margin-bottom: 15px;">Hvor bor {% if users|length > 1 %}dere{% else %}du{% endif %}?</h2>
        <div class="control-group country">
          <label> Land <span class="asterisk red">*</span></label>
          <select name="country">
            <optgroup id="scandinavia" label="Scandinavia">
              <option value="{{ countries_norway.code }}"{% if location.country == countries_norway.code or not location %} selected{% endif %}>{{ countries_norway.name }}</option>
              {% for c in countries_other_scandinavian %}
                <option value="{{ c.code }}"{% if location.country == c.code %} selected{% endif %}>{{ c.name }}</option>
              {% endfor %}
            </optgroup>
            <optgroup id="world" label="Rest of world">
            {% for c in countries_other %}
              <option value="{{ c.code }}"{% if location.country == c.code %} selected{% endif %}>{{ c.name }}</option>
            {% endfor %}
            </optgroup>
          </select>
        </div>
        <div class="control-group address1">
          <label> Adresse <span class="asterisk red">*</span></label>
          <input type="text" class="input-large" name="address1" value="{{ location.address1 }}">
        </div>
        <div class="scandinavia">
          <div class="control-group zipcode">
            <label> Postnummer / Poststed <span class="asterisk red">*</span></label>
            <input type="text" class="input-small" name="zipcode" value="{{ location.zipcode }}" maxlength="10">
            <input type="text" class="input-medium" name="city" value="{{ location.city }}" disabled>
            <img src="{{ STATIC_URL }}img/ajax-loader-small.gif" class="zip ajaxloader" alt="Laster poststed..." title="Laster poststed...">
          </div>
        </div>
        <div class="world">
          <div class="control-group address2">
            <label> Adresse 2</label>
            <input type="text" class="input-large" name="address2" value="{{ location.address2 }}">
          </div>
          <div class="control-group address3">
            <label> Adresse 3</label>
            <input type="text" class="input-large" name="address3" value="{{ location.address3 }}">
          </div>
        </div>
        {% if main %}
        <div class="control-group yearbook">
          <label class="checkbox">
            <input type="checkbox" name="yearbook"{% if yearbook %} checked{% endif %}> Motta Årboken og Fjell og Vidde mot et årlig gebyr på kr. {{ foreign_yearbook_price }}
          </label>
        </div>
        {% endif %}
      </div>

      <div class="well">
        <h2>Husstandsmedlemskap</h2>
        <p>
          Bor {% if users|length > 1 %}dere{% else %}du{% endif %} sammen med et <strong>eksisterende</strong> hovedmedlem, kan {% if users|length > 1 %}dere{% else %}du{% endif %} få billigere medlemsskap som husstandsmedlem{% if users|length > 1 %}mer{% endif %}.
        </p>
        <p>
          <input type="text" name="existing" value="{{ existing }}" placeholder="Oppgi medlemsnummer...">
          <button class="btn search"><i class="icon-search"></i> Søk</button>
          <img src="{{ STATIC_URL }}img/ajax-loader-small.gif" class="existing ajaxloader" alt="Laster medlemsinfo..." title="Laster medlemsinfo...">
        </p>

        <div class="existing-result">
          <p><span class="description">Hovedmedlem: </span><span class="result"></span></p>
        </div>

      </div>
      <p>
        <a class="btn btn-large" href="{% url enrollment.views.registration %}"><i class="icon-arrow-left"></i> Tilbake</a>
        <button class="btn btn-danger btn-large" type="submit">Gå videre <i class="icon-arrow-right"></i></button>
      </p>
    </form>
  </div>

  <div class="span4">
    <div class="well">
      <p><i class="icon-info-sign"></i> <strong>Har du spørsmål?</strong></p>
      <p>
        Kontakt medlemsservice:<br>
        Telefon: 4000 1970<br>
        <a href="mailto:medlem@turistforeningen.no">medlem@turistforeningen.no</a><br>
        Åpent alle hverdager:<br>
        Kl. 09.00 - 16.00
      </p>
    </div>
  </div>
</div>

{% endblock %}
